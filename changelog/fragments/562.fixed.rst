Progress Bar fixed, tests added to ensure the right behavior.
